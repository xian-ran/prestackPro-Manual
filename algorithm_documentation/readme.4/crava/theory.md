# Theory

## Introduction

Seismic inversion has traditionally been treated as a deterministic problem. However, there are several uncertain aspects: There is noise in the seismic amplitude data, and the frequency resolution is limited. This means that neither high nor low frequencies can be resolved from the seismic amplitude data alone. Using a geostatistical approach to the problem of seismic inversion, the uncertainty may be treated in a consistent and robust way.

The CRAVA program uses the Bayesian linearised AVO inversion method of Buland and al. \(2003\) to take the uncertainty in seismic amplitude data into account. Since we only use amplitude data, we will from here on use the term seismic data for these. The seismic data are described using multi-normal distributions, and modelled as the seismic response of the earth model plus an error term. The earth model and error term are modelled as multi-normal distributions in which spatial coupling is imposed by correlation functions. Using a Bayesian setting, prior models for the earth and error terms are set up based on prior knowledge obtained from well logs, and the process of seismic inversion is reduced to that of finding a posterior distribution for the earth given the seismic data. The linearised relationship between the model parameters and the AVO data, makes it possible to obtain the posterior distribution analytically.

The posterior distribution for earth model parameters $$V_p$$ \(pressure-wave velocity\), $$V_s$$ \(shear-wave velocity\), and $$\rho$$ \(density\), gives a laterally consistent seismic inversion. The lateral correlation can follow the stratigraphy of the inversion interval by following the top and/or base of the inversion volume, but can also be specified independently using a correlation surface. As a consequence of the spatial coupling, the solution in each location depends on the solutions in all other locations. From the posterior distribution the best estimate of the model parameters and a corresponding uncertainty can be extracted. Moreover, since the distribution is Gaussian, kriging can be used to match the well data, and the posterior covariance can be computed. This spreads full frequency information in an area around the wells. Full frequency realizations can be generated by sampling from the posterior distribution. A set of such realizations represents the uncertainty of the inversion.

## AVO

Amplitude versus offset \(AVO\) inversion can be used to extract information about the elastic subsurface parameters from the angle dependency in the reflectivity, see e.g., Buland et al. \(1996\); Hampson and Russell \(1990\); Lörtzer and Berkhout \(1993\); Pan et al. \(1994\). In practice, and especially for 3-D surveys, linearised AVO inversion is attractive since it can be performed with use of moderate computer resources. Prior to a linearised AVO inversion, the seismic data must be processed to remove nonlinear relations between the model parameters and the seismic response. Important steps in the processing are the removal of the move-out, multiples, and the effects of geometrical spreading and absorption. The seismic data should be pre-stack migrated, such that dip related effects are removed. After pre-stack migration, it is reasonable to assume that each single bin-gather can be regarded as the response of a local 1-D earth model. The benefits of pre-stack migration before AVO analysis are discussed in Brown \(1992\); Buland and Landrø \(2001\); Mosher et al. \(1996\). It is further assumed that wave mode conversions, interbed multiples and anisotropy effects can be neglected after processing. Ideally, the pre-stack gathers are also transformed from offsets to reflection angles. Offset gathers are often close to angle gathers, so we can use these, but if the inversion area is thick, this will give more noise in the CRAVA model.

## Seismic model

The seismic response of an isotropic, elastic medium is completely described by the three material parameters $${V_p(\mathbf{x},t), V_s(\mathbf{x},t), \rho(\mathbf{x},t)}$$, where the vector $$\mathbf{x}$$ gives the lateral position \(x,y\), and $$t$$ is the vertical seismic travel time.

The weak contrast approximation by Aki and Richards \(1980\), relates the seismic reflection coefficients $$c(\mathbf{x},t,\theta)$$ to the elastic medium, and is a linearization of the Zoeppritz equations. A continuous version of this approximation is given by Stolt and Weglein \(1985\):

$$
c(\mathbf{x},t,\theta) = a_{V\!p} (\theta) \frac{\partial}{\partial t}\ln V_p (\mathbf{x},t) + a_{V\!s} (\mathbf{x},t,\theta) \frac{\partial}{\partial t}\ln V_s (\mathbf{x},t) + a_\rho(\mathbf{x},t,\theta) \frac{\partial}{\partial t}\ln\rho(\mathbf{x},t)
$$

where $$\theta$$ is the PP reflection angle, and  

$$
a_{V\!p} (\theta) =\frac{1}{2}\left(1 + \tan^2\theta\right)
$$

$$
a_{V\!s} (\mathbf{x},t,\theta) = -4 \frac{V_s^2(\mathbf{x},t)}{V_p^2(\mathbf{x},t)}\sin^2\theta
$$

$$
a_\rho(\mathbf{x},t,\theta) = \frac{1}{2}\left(1
 -4\frac{V_s^2(\mathbf{x},t)}{V_p^2(\mathbf{x},t)}
\sin^2\theta\right)
$$

for PP reflections, and, 

$$
a_{V\!p} (\theta)            = 0
$$

$$
a_{V\!s} (\mathbf{x},t,\theta) = 2 \frac{\sin\theta}{\cos\phi}\left(\frac{V_s^2(\mathbf{x},t)}
                                         {V_p^2(\mathbf{x},t)}\sin^2\theta - \frac{V_s(\mathbf{x},t)}{V_p(\mathbf{x},t)}\cos\theta\cos\phi\right)
$$

$$
a_\rho(\mathbf{x},t,\theta)    = \frac{\sin\theta}{\cos\phi}\left(-\frac{1}{2}+\frac{V_s^2(\mathbf{x},t)}
                                         {V_p^2(\mathbf{x},t)}\sin^2\theta + \frac{V_s(\mathbf{x},t)}{V_p(\mathbf{x},t)}\cos\theta\cos\phi\right)
$$

for PS reflections. Here, $$\phi$$ is the PS reflection angle, given by $$\sin\phi = (V_s/V_p)\sin\theta$$. These equations are linearised by replacing the ratio $$V_s(\mathbf{x},t)/V_p(\mathbf{x},t)$$ with a constant value $$\bar{V_p}/\bar{V_s}$$ when computing the coefficients.

The seismic data are represented by the convolutional model 

$$
d_{obs}(\mathbf{x},t,\theta) =\int w(\tau,\theta) \: c(\mathbf{x},t-\tau,\theta) \: d\tau + e(\mathbf{x},t,\theta)
$$

where $$w$$ is the wavelet, and $$e$$ is an angle and location dependent error term. The integral is the synthetic seismic. The wavelet can be angle dependent, and can vary laterally according to scale and shift maps. The wavelet is assumed to be stationary within a limited target window.

The signal-to-noise ratio is defined as the ratio of the energy of the data to the energy of the noise as given in the equation above, that is, 

$$
S/N = \left(| w*c|^2+| e|^2\right) / | e|^2
$$

where the operator $$*$$denotes the convolution. Since the error is independent of the synthetic seismic, the energy form the synthetic seismic and the noise can simply be added. Note that there also exists another definition of the S/N ratio where the noise energy is not included in the enumerator.

### Convolution with 3D wavelet

The seismic data can also be represented as a convolution in three dimensions

$$
d_{obs}(\mathbf{x},t,\theta)
    =\int w(\mathbf{x},\tau,\theta) \: c(\mathbf{x}-\mathbf{\chi},t-\tau,\theta) \: d\mathbf{\chi}d\tau + e(\mathbf{x},t,\theta)
$$

where $$w$$ now denotes a 3D wavelet. The 3D wavelet is derived from the point-spread function \(PSF\) which acts as a filter on the reflectivity cube to mimic the imaging process of pre-stack depth migration. For a thorough description on how the PSF is calculated with ray-tracing by identifying the illumination vectors, see Lecomte \(2008\). For a more physical interpretation of the PSF, the parametrisation in the wavenumber \(Fourier\) domain is done in terms of spherical coordinates. The relationship between these coordinates and the spatial frequencies $$\mathbf{k}=(k_x,k_y, k_z)$$ for a point $$P$$ is given by

$$
k_x=r\cos(\phi)\sin(\psi),\; k_y=r\sin(\phi)\sin(\psi),\; k_z=r\cos(\psi)
$$

where $$r$$ is the radial distance from origo to $$P$$,$$\phi$$ is the azimuth angle between the line from origo to $$P$$ projected into the $$(k_x; k_y)$$-plane and the $$k_x$$-axis and $$\psi$$ is the dip angle defined as the inclination angle between the line from origo to $$P$$ and the upward pointing $$k_z$$-axis. $$\phi$$ varies between $$0^\circ$$ and $$360^\circ$$ while $$\psi$$ varies between $$0^\circ$$and $$90^\circ$$ implying that only upwards scattering reflections are considered, and not turning waves.

Defining the temporal frequency $$\omega = V_0r(2\cos{\theta})^{-1}$$ where $$V_0$$ is the average velocity for the region of interest and $$\cos{\theta}$$ represents a stretch factor due to reflection angle, the model for the point-spread function, $$f$$, is given by

$$
\tilde{f}(r,\phi,\psi;\theta) 
  = \tilde{\alpha}_1(\phi,\psi;\theta)
    \tilde{\alpha}_2(\omega,\phi,\psi;\theta)
    \tilde{w}_0\left(\omega;\theta\right)
$$

where the tilde denotes Fourier transform, $$\tilde{w}_0(\omega;\theta)$$ is the 1D pulse and functions $$\tilde{\alpha}_1(\phi,\psi;\theta)$$ and $$\tilde{\alpha}_2(\omega,\phi,\psi;\theta) = \exp(-\pi |\omega| \tilde{H}(\phi,\psi;\theta))$$ are frequency independent and frequency dependent processing factors respectively.

Since the point-spread function is defined in the depth domain, and the 3D wavelet in expression above  is in time domain, a relation between time and depth is needed. In the region of interest, a target center is defined at depth $$Z_0$$_._ A reference time surface $$T_0(x,y)$$ corresponds to this depth. For a given time $$\tau$$ the corresponding depth is $$\zeta$$. Let $$T_{\tau}(x,y)$$  be the time to a point, and $$Z_{\zeta}(x,y)$$ the depth to the same point, the time-depth relation is:

$$
T_{\tau}(x,y) = T_0(x,y) + \frac{2}{V_0}(Z_{\zeta}(x,y)-Z_0)
$$

## Statistical model

The elastic parameters $$V_p(\mathbf{x},t)$$,$$V_s(\mathbf{x},t)$$, and $$\rho(\mathbf{x},t)$$ are assumed to be log-normal random fields. This means that the distribution $$\mathbf{m}(\mathbf{x},t) = \left[\ln V_p(\mathbf{x},t),\ln V_s(\mathbf{x},t),\ln\rho(\mathbf{x},t)\right]^T$$ is multi-normal or multi-Gaussian, that is,

$$
\mathbf{m}(\mathbf{x},t) \sim
  \mathcal{N}\left(\mu_m(\mathbf{x},t),\sum_m(\mathbf{x}_1,t_1;\mathbf{x}_2,t_2)\right)
$$

where $$\mu_m(\mathbf{x},t)$$ are the expectations of $$\mathbf{m}(\mathbf{x},t)$$ and $$\sum_m(\mathbf{x}_1,t_1;\mathbf{x}_2,t_2)$$ gives the covariance structure. We assume that the covariance function is stationary and homogeneous \(i.e., translationally invariant\), and can be factorised as

$$
\sum_m(\mathbf{x}_1,t_1;\mathbf{x}_2,t_2)
    = \sum_{0,m} \: \nu_m(\xi) \nu_m(\tau)
$$

where $$\nu_m(\xi)$$ and $$\nu_m(\tau)$$ are correlation functions depending on the lateral and temporal distances $$\xi = |\mathbf{x}2 - \mathbf{x}_1|$$ __and __$$\tau=|t_2-t_1|$$_,_ respectively, and __$$\sum_{0,m}$$ is a $$3\times 3$$ matrix of the variances and covariances of $$\ln V_p$$, $$\ln V_s$$ and $$\ln\rho$$. Any covariance structure giving a positive definite $$\sum_m$$ may be used.

If we let $$\mathbf{m}$$ and $$\mathbf{d}{obs}$$ __be discrete representations of __$$\mathbf{m}(\mathbf{x},t)$$ __and __$$d{obs}(\mathbf{x},t,\theta)$$ in a time interval, Equation above may be written in matrix notation as

$$
\mathbf{d}_{obs}  = \mathbf{W}\mathbf{A}\mathbf{D}\mathbf{m} + \mathbf{e}
$$

$$
=  \mathbf{G}\mathbf{m} + \mathbf{e}
$$

where $$\mathbf{W}$$ is the matrix representation of the wavelets, $$\mathbf{A}$$ is a matrix encompassing discrete representations of the coefficients $$a_{V_p}$$, $$a_{V_s}$$, and $$a_\rho$$, $$\mathbf{D}$$ is a differential matrix and $$\mathbf{G} = \mathbf{W}\mathbf{A}\mathbf{D}$$. The error matrix $$\mathbf{e}$$ is a time discretization of the error vector $$\mathbf{e}(\mathbf{x},t) = [e(\mathbf{x},t,\theta_1),\ldots, e(\mathbf{x},t,\theta{n_{\theta}})]^T$$ and is assumed to be zero-mean coloured Gaussian noise, that is,

$$
\mathbf{e}(\mathbf{x},t)
    \sim \mathcal{N}_{n_\theta}\left(\mathbf{0},
               \sum_e(\mathbf{x}_1,t_1;\mathbf{x}_2,t_2)\right)
$$

The covariance of the error vector is

$$
\sum_e(\mathbf{x}_1,t_1;\mathbf{x}_2,t_2)
    = \sum_{0,e} \: \nu_e(\xi) \nu_e(\tau)
$$

where $$\sum_{0,e}$$ is an $$n{\theta}\times n_{\theta}$$ covariance matrix containing the noise variances for the different reflection angles on the diagonal, and the covariances between the angles off the diagonal. Furthermore, $$\nu_e(\xi)$$ and $$\nu_e(\tau)$$ are lateral and temporal correlation functions, similar to those given for $$\mathbf{m}(\mathbf{x},t)$$.

Since the relationship between the reflection coefficients and the elastic parameters given in Aki-Richards is linear, and the elastic parameters are assumed Gaussian distributed, the reflection coefficients become Gaussian. Moreover, since the convolution is a linear operation and we have assumed a Gaussian error model, the seismic data given in the equation above are also Gaussian distributed.

For the time-discretized seismic data $$\mathbf{d}_{obs}$$, this gives us the multi-normal distribution

$$
\mathbf{d}_{obs} \sim
    \mathcal{N}_{n_d}\left(\mu_d,\sum_d\right)
$$

where

$$
\mu_d = \mathbf{G}\mu_{m}
$$

$$
\sum_d= \mathbf{G}\sum_{m}\mathbf{G}^T + \sum_e
$$

where all vectors and matrices are time-discretized.

This means that the simultaneous distribution for $$\mathbf{m}$$ and $$\mathbf{d}_{obs}$$ __is Gaussian, and that the distribution for $$\mathbf{m}$$ given $$\mathbf{d}_{obs}$$ can be obtained analytically using standard theory for Gaussian distributions:

$$
\mu_{m|d_{obs}}  =\mu_{m} +\Sigma_{m}\mathbf{G}^T \Sigma_{d}^{-1}
                           (\mathbf{d}_{obs}-\mu_{d})
$$

$$
\Sigma_{m|d_{obs}} =\Sigma_{m} - \Sigma_{m}\mathbf{G}^T
                           \Sigma_{d}^{-1}\mathbf{G}\Sigma_{m}
$$

where $$\mu_{d}$$ __is the expected observation, that is, the seismic response of $$\mu_m$$, and $$\Sigma_{d,m}$$ is the covariance matrix between logarithmic parameters and observations. See Buland and Omre \(2003\) for a detailed description on how to compute these.

The computations given in the equations above involves the inverse of $$\Sigma_{d}$$. Given an inversion volume with $$n$$ cells, this matrix has $$n_\theta^2n^2$$ elements, and for any reasonably sized volumes, inverting this matrix is forbiddingly time consuming. However, the covariance function for a homogeneously correlated spatial variable is diagonalised by a 3D Fourier transform \(Christakos \(1992\)\), and in this domain the inversion problem can be solved independently for each frequency component. This reduces the complexity of the computations dramatically, and the calculation time becomes $$\mathcal{O}(n\log n)$$. This is illustrated in the figure below. Details can be found in Buland et al. \(2003\).

![The problem is transformed to the Fourier domain, solved in this domain, and back-transformed to time domain.](../../../.gitbook/assets/image%20%2829%29.png)

This seems to require that d is stationary, which would imply that the wavelet must be the same everywhere. However, we can divide out the wavelet from the equation above to obtain

$$
\mathbf{d^\prime} = \mathbf{A}\mathbf{D}\mathbf{m} + \mathbf{e^\prime}
$$

where $$\mathbf{d^\prime}$$is the data divided by the wavelet, and $$\mathbf{e^\prime}$$ is the error divided by the wavelet. The details of how we do this division is given in [Implementation](implementation.md#local-wavelet-dividing-out-the-wavelet). Note that we now assume that the noise after division, $$\mathbf{e^\prime}$$ is stationary. Since we assume that a seismic response only depends on the reflections in that trace, this division can be done trace by trace. This assumption relies on a rather smooth seismic response, so the lateral variations in the wavelet should be smooth. We have chosen to restrict the local wavelet changes to only allow local temporal shift and amplitude scaling.

We can also work around the stationary noise assumption, and allow $$\mathbf{e^\prime}$$ to vary laterally. This is done by utilising the nature of a Bayesian solution, which always is a tradeoff between the prior and the posterior with noise free data. By finding the posterior for a minimal noise, we can then interpolate between this solution and the prior to find an appropriate solution for the local noise level. When doing this, we ignore the lateral correlation, so we require constant noise level in each trace, since the conditional correlations inside a trace are much stronger than between traces. See [Implementation](implementation.md#local-noise) for details.

